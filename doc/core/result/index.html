<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="`Result` 类型的错误处理。"><meta name="keywords" content="rust, rustlang, rust-lang, result"><title>core::result - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize1.55.0.css"><link rel="stylesheet" type="text/css" href="../../rustdoc1.55.0.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light1.55.0.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark1.55.0.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu1.55.0.css" disabled ><script id="default-settings"></script><script src="../../storage1.55.0.js"></script><script src="../../crates1.55.0.js"></script><noscript><link rel="stylesheet" href="../../noscript1.55.0.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon1.55.0.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x161.55.0.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x321.55.0.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow1.55.0.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../core/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo1.55.0.png' alt='logo'></div></a><h2 class="location">Module result</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div><div id="sidebar-vars" data-name="result" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img src="../../brush1.55.0.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img src="../../wheel1.55.0.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">core</a>::<wbr><a class="mod" href="#">result</a><button id="copy-path" onclick="copy_path(this)" title="copy path"><img src="../../clipboard1.55.0.svg" width="19" height="18" alt="Copy item import" title="Copy item import to clipboard"></button></span><span class="out-of-band"><span class="since" title="Stable since Rust version 1.0.0">1.0.0</span><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/core/result.rs.html#1-1900" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><code>Result</code> 类型的错误处理。</p>
<p><a href="enum.Result.html" title="Result"><code>Result&lt;T, E&gt;</code></a> 是用于返回和传播错误的类型。
它是一个枚举，成员 <a href="enum.Result.html#variant.Ok"><code>Ok(T)</code></a> 表示成功并包含一个值，而 <a href="enum.Result.html#variant.Err"><code>Err(E)</code></a> 表示错误并包含错误值。</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">enum</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">E</span><span class="op">&gt;</span> {
   <span class="prelude-val">Ok</span>(<span class="ident">T</span>),
   <span class="prelude-val">Err</span>(<span class="ident">E</span>),
}</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0A%23%5Ballow(dead_code)%5D%0Aenum%20Result%3CT%2C%20E%3E%20%7B%0A%20%20%20Ok(T)%2C%0A%20%20%20Err(E)%2C%0A%7D%0A%7D&amp;edition=2018">Run</a></div>
<p>只要预期到错误并且可以恢复，函数就返回 <a href="enum.Result.html" title="Result"><code>Result</code></a>。在 <code>std</code> crate 中，<a href="enum.Result.html" title="Result"><code>Result</code></a> 最主要用于 <a href="../../std/io/index.html">I/O</a>。</p>
<p>返回 <a href="enum.Result.html" title="Result"><code>Result</code></a> 的简单函数可以像这样定义和使用:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">enum</span> <span class="ident">Version</span> { <span class="ident">Version1</span>, <span class="ident">Version2</span> }

<span class="kw">fn</span> <span class="ident">parse_version</span>(<span class="ident">header</span>: <span class="kw-2">&amp;</span>[<span class="ident">u8</span>]) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">Version</span>, <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> <span class="ident">str</span><span class="op">&gt;</span> {
    <span class="kw">match</span> <span class="ident">header</span>.<span class="ident">get</span>(<span class="number">0</span>) {
        <span class="prelude-val">None</span> <span class="op">=</span><span class="op">&gt;</span> <span class="prelude-val">Err</span>(<span class="string">&quot;invalid header length&quot;</span>),
        <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="number">1</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="prelude-val">Ok</span>(<span class="ident">Version::Version1</span>),
        <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="number">2</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="prelude-val">Ok</span>(<span class="ident">Version::Version2</span>),
        <span class="prelude-val">Some</span>(<span class="kw">_</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="prelude-val">Err</span>(<span class="string">&quot;invalid version&quot;</span>),
    }
}

<span class="kw">let</span> <span class="ident">version</span> <span class="op">=</span> <span class="ident">parse_version</span>(<span class="kw-2">&amp;</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);
<span class="kw">match</span> <span class="ident">version</span> {
    <span class="prelude-val">Ok</span>(<span class="ident">v</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="macro">println!</span>(<span class="string">&quot;working with version: {:?}&quot;</span>, <span class="ident">v</span>),
    <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="macro">println!</span>(<span class="string">&quot;error parsing header: {:?}&quot;</span>, <span class="ident">e</span>),
}</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0A%23%5Bderive(Debug)%5D%0Aenum%20Version%20%7B%20Version1%2C%20Version2%20%7D%0A%0Afn%20parse_version(header%3A%20%26%5Bu8%5D)%20-%3E%20Result%3CVersion%2C%20%26'static%20str%3E%20%7B%0A%20%20%20%20match%20header.get(0)%20%7B%0A%20%20%20%20%20%20%20%20None%20%3D%3E%20Err(%22invalid%20header%20length%22)%2C%0A%20%20%20%20%20%20%20%20Some(%261)%20%3D%3E%20Ok(Version%3A%3AVersion1)%2C%0A%20%20%20%20%20%20%20%20Some(%262)%20%3D%3E%20Ok(Version%3A%3AVersion2)%2C%0A%20%20%20%20%20%20%20%20Some(_)%20%3D%3E%20Err(%22invalid%20version%22)%2C%0A%20%20%20%20%7D%0A%7D%0A%0Alet%20version%20%3D%20parse_version(%26%5B1%2C%202%2C%203%2C%204%5D)%3B%0Amatch%20version%20%7B%0A%20%20%20%20Ok(v)%20%3D%3E%20println!(%22working%20with%20version%3A%20%7B%3A%3F%7D%22%2C%20v)%2C%0A%20%20%20%20Err(e)%20%3D%3E%20println!(%22error%20parsing%20header%3A%20%7B%3A%3F%7D%22%2C%20e)%2C%0A%7D%0A%7D&amp;edition=2018">Run</a></div>
<p>在简单情况下，在 <a href="enum.Result.html" title="Result"><code>Result</code></a> 上进行模式匹配非常简单明了，但是 <a href="enum.Result.html" title="Result"><code>Result</code></a> 附带了一些方便的方法，使使用它更加简洁。</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">let</span> <span class="ident">good_result</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="ident">i32</span><span class="op">&gt;</span> <span class="op">=</span> <span class="prelude-val">Ok</span>(<span class="number">10</span>);
<span class="kw">let</span> <span class="ident">bad_result</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="ident">i32</span><span class="op">&gt;</span> <span class="op">=</span> <span class="prelude-val">Err</span>(<span class="number">10</span>);

<span class="comment">// `is_ok` 和 `is_err` 方法按照他们说的做。</span>
<span class="macro">assert!</span>(<span class="ident">good_result</span>.<span class="ident">is_ok</span>() <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="ident">good_result</span>.<span class="ident">is_err</span>());
<span class="macro">assert!</span>(<span class="ident">bad_result</span>.<span class="ident">is_err</span>() <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="ident">bad_result</span>.<span class="ident">is_ok</span>());

<span class="comment">// `map` 消耗 `Result` 并产生另一个。</span>
<span class="kw">let</span> <span class="ident">good_result</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="ident">i32</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">good_result</span>.<span class="ident">map</span>(<span class="op">|</span><span class="ident">i</span><span class="op">|</span> <span class="ident">i</span> <span class="op">+</span> <span class="number">1</span>);
<span class="kw">let</span> <span class="ident">bad_result</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="ident">i32</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">bad_result</span>.<span class="ident">map</span>(<span class="op">|</span><span class="ident">i</span><span class="op">|</span> <span class="ident">i</span> <span class="op">-</span> <span class="number">1</span>);

<span class="comment">// 使用 `and_then` 继续计算。</span>
<span class="kw">let</span> <span class="ident">good_result</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">bool</span>, <span class="ident">i32</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">good_result</span>.<span class="ident">and_then</span>(<span class="op">|</span><span class="ident">i</span><span class="op">|</span> <span class="prelude-val">Ok</span>(<span class="ident">i</span> <span class="op">=</span><span class="op">=</span> <span class="number">11</span>));

<span class="comment">// 使用 `or_else` 处理该错误。</span>
<span class="kw">let</span> <span class="ident">bad_result</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="ident">i32</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">bad_result</span>.<span class="ident">or_else</span>(<span class="op">|</span><span class="ident">i</span><span class="op">|</span> <span class="prelude-val">Ok</span>(<span class="ident">i</span> <span class="op">+</span> <span class="number">20</span>));

<span class="comment">// 消费结果并用 `unwrap` 返回内容。</span>
<span class="kw">let</span> <span class="ident">final_awesome_result</span> <span class="op">=</span> <span class="ident">good_result</span>.<span class="ident">unwrap</span>();</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Alet%20good_result%3A%20Result%3Ci32%2C%20i32%3E%20%3D%20Ok(10)%3B%0Alet%20bad_result%3A%20Result%3Ci32%2C%20i32%3E%20%3D%20Err(10)%3B%0A%0A%2F%2F%20%60is_ok%60%20%E5%92%8C%20%60is_err%60%20%E6%96%B9%E6%B3%95%E6%8C%89%E7%85%A7%E4%BB%96%E4%BB%AC%E8%AF%B4%E7%9A%84%E5%81%9A%E3%80%82%0Aassert!(good_result.is_ok()%20%26%26%20!good_result.is_err())%3B%0Aassert!(bad_result.is_err()%20%26%26%20!bad_result.is_ok())%3B%0A%0A%2F%2F%20%60map%60%20%E6%B6%88%E8%80%97%20%60Result%60%20%E5%B9%B6%E4%BA%A7%E7%94%9F%E5%8F%A6%E4%B8%80%E4%B8%AA%E3%80%82%0Alet%20good_result%3A%20Result%3Ci32%2C%20i32%3E%20%3D%20good_result.map(%7Ci%7C%20i%20%2B%201)%3B%0Alet%20bad_result%3A%20Result%3Ci32%2C%20i32%3E%20%3D%20bad_result.map(%7Ci%7C%20i%20-%201)%3B%0A%0A%2F%2F%20%E4%BD%BF%E7%94%A8%20%60and_then%60%20%E7%BB%A7%E7%BB%AD%E8%AE%A1%E7%AE%97%E3%80%82%0Alet%20good_result%3A%20Result%3Cbool%2C%20i32%3E%20%3D%20good_result.and_then(%7Ci%7C%20Ok(i%20%3D%3D%2011))%3B%0A%0A%2F%2F%20%E4%BD%BF%E7%94%A8%20%60or_else%60%20%E5%A4%84%E7%90%86%E8%AF%A5%E9%94%99%E8%AF%AF%E3%80%82%0Alet%20bad_result%3A%20Result%3Ci32%2C%20i32%3E%20%3D%20bad_result.or_else(%7Ci%7C%20Ok(i%20%2B%2020))%3B%0A%0A%2F%2F%20%E6%B6%88%E8%B4%B9%E7%BB%93%E6%9E%9C%E5%B9%B6%E7%94%A8%20%60unwrap%60%20%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%E3%80%82%0Alet%20final_awesome_result%20%3D%20good_result.unwrap()%3B%0A%7D&amp;edition=2018">Run</a></div>
<h1 id="必须使用结果" class="section-header"><a href="#必须使用结果">必须使用结果</a></h1>
<p>使用返回值指示错误的一个常见问题是，很容易忽略返回值，从而无法处理错误。
<a href="enum.Result.html" title="Result"><code>Result</code></a> 带有 <code>#[must_use]</code> 属性的注解，它将导致编译器在忽略 Result 值时发出警告。
这使得 <a href="enum.Result.html" title="Result"><code>Result</code></a> 对于可能遇到错误但不会返回有用值的函数特别有用。</p>
<p>考虑 <a href="../../std/io/trait.Write.html"><code>Write</code></a> trait 为 I/O 类型定义的 <a href="../../std/io/trait.Write.html#method.write_all"><code>write_all</code></a> 方法:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std::io</span>;

<span class="kw">trait</span> <span class="ident">Write</span> {
    <span class="kw">fn</span> <span class="ident">write_all</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">bytes</span>: <span class="kw-2">&amp;</span>[<span class="ident">u8</span>]) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span>(), <span class="ident">io::Error</span><span class="op">&gt;</span>;
}</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Ause%20std%3A%3Aio%3B%0A%0Atrait%20Write%20%7B%0A%20%20%20%20fn%20write_all(%26mut%20self%2C%20bytes%3A%20%26%5Bu8%5D)%20-%3E%20Result%3C()%2C%20io%3A%3AError%3E%3B%0A%7D%0A%7D&amp;edition=2018">Run</a></div>
<p><em>Note: <a href="../../std/io/trait.Write.html"><code>Write</code></a> 的实际定义使用 <a href="../../std/io/type.Result.html"><code>io::Result</code></a>，它只是 <a href="enum.Result.html" title="Result"><code>Result</code></a><code> 的同义词。</code><a href="../../std/io/struct.Error.html"><code>io::Error</code></a><code>&gt;</code>.</em></p>
<p>该方法不会产生值，但是写入可能会失败。处理错误情况至关重要，并且 <em>不要</em> 编写类似以下内容的代码:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std::fs::File</span>;
<span class="kw">use</span> <span class="ident">std::io::prelude</span>::<span class="kw-2">*</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">file</span> <span class="op">=</span> <span class="ident">File::create</span>(<span class="string">&quot;valuable_data.txt&quot;</span>).<span class="ident">unwrap</span>();
<span class="comment">// 如果 `write_all` 错误，那么我们将永远不会知道，因为返回值将被忽略。</span>
<span class="comment">//</span>
<span class="ident">file</span>.<span class="ident">write_all</span>(<span class="string">b&quot;important message&quot;</span>);</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0A%23!%5Ballow(unused_must_use)%5D%20%2F%2F%20%5Co%2F%0Afn%20main()%20%7B%0Ause%20std%3A%3Afs%3A%3AFile%3B%0Ause%20std%3A%3Aio%3A%3Aprelude%3A%3A*%3B%0A%0Alet%20mut%20file%20%3D%20File%3A%3Acreate(%22valuable_data.txt%22).unwrap()%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9C%20%60write_all%60%20%E9%94%99%E8%AF%AF%EF%BC%8C%E9%82%A3%E4%B9%88%E6%88%91%E4%BB%AC%E5%B0%86%E6%B0%B8%E8%BF%9C%E4%B8%8D%E4%BC%9A%E7%9F%A5%E9%81%93%EF%BC%8C%E5%9B%A0%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC%E5%B0%86%E8%A2%AB%E5%BF%BD%E7%95%A5%E3%80%82%0A%2F%2F%0Afile.write_all(b%22important%20message%22)%3B%0A%7D&amp;edition=2018">Run</a></div>
<p>如果您确实将其写在 Rust 中，则编译器将向您发出警告 (默认情况下，由 <code>unused_must_use</code> lint 控制)。</p>
<p>相反，如果您不想处理该错误，则可以断言 <a href="enum.Result.html#method.expect"><code>expect</code></a> 成功。
如果写入失败，这将为 panic，提供了一条边际有用的消息，指出原因:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std::fs::File</span>;
<span class="kw">use</span> <span class="ident">std::io::prelude</span>::<span class="kw-2">*</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">file</span> <span class="op">=</span> <span class="ident">File::create</span>(<span class="string">&quot;valuable_data.txt&quot;</span>).<span class="ident">unwrap</span>();
<span class="ident">file</span>.<span class="ident">write_all</span>(<span class="string">b&quot;important message&quot;</span>).<span class="ident">expect</span>(<span class="string">&quot;failed to write message&quot;</span>);</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Ause%20std%3A%3Afs%3A%3AFile%3B%0Ause%20std%3A%3Aio%3A%3Aprelude%3A%3A*%3B%0A%0Alet%20mut%20file%20%3D%20File%3A%3Acreate(%22valuable_data.txt%22).unwrap()%3B%0Afile.write_all(b%22important%20message%22).expect(%22failed%20to%20write%20message%22)%3B%0A%7D&amp;edition=2018">Run</a></div>
<p>您可能还简单地宣称成功:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="macro">assert!</span>(<span class="ident">file</span>.<span class="ident">write_all</span>(<span class="string">b&quot;important message&quot;</span>).<span class="ident">is_ok</span>());</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Ause%20std%3A%3Afs%3A%3AFile%3B%0Ause%20std%3A%3Aio%3A%3Aprelude%3A%3A*%3B%0Alet%20mut%20file%20%3D%20File%3A%3Acreate(%22valuable_data.txt%22).unwrap()%3B%0Aassert!(file.write_all(b%22important%20message%22).is_ok())%3B%0A%7D&amp;edition=2018">Run</a></div>
<p>或者使用 <a href="../ops/trait.Try.html"><code>?</code></a> 在调用栈中传播错误:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">fn</span> <span class="ident">write_message</span>() <span class="op">-</span><span class="op">&gt;</span> <span class="ident">io::Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">file</span> <span class="op">=</span> <span class="ident">File::create</span>(<span class="string">&quot;valuable_data.txt&quot;</span>)<span class="question-mark">?</span>;
    <span class="ident">file</span>.<span class="ident">write_all</span>(<span class="string">b&quot;important message&quot;</span>)<span class="question-mark">?</span>;
    <span class="prelude-val">Ok</span>(())
}</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Ause%20std%3A%3Afs%3A%3AFile%3B%0Ause%20std%3A%3Aio%3A%3Aprelude%3A%3A*%3B%0Ause%20std%3A%3Aio%3B%0A%23%5Ballow(dead_code)%5D%0Afn%20write_message()%20-%3E%20io%3A%3AResult%3C()%3E%20%7B%0A%20%20%20%20let%20mut%20file%20%3D%20File%3A%3Acreate(%22valuable_data.txt%22)%3F%3B%0A%20%20%20%20file.write_all(b%22important%20message%22)%3F%3B%0A%20%20%20%20Ok(())%0A%7D%0A%7D&amp;edition=2018">Run</a></div>
<h1 id="问号运算符-" class="section-header"><a href="#问号运算符-">问号运算符， <code>?</code></a></h1>
<p>在编写调用许多返回 <a href="enum.Result.html" title="Result"><code>Result</code></a> 类型的函数的代码时，错误处理可能很乏味。
问号运算符 <a href="../ops/trait.Try.html"><code>?</code></a> 在调用栈中隐藏了一些传播错误的样板。</p>
<p>它将替换为:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std::fs::File</span>;
<span class="kw">use</span> <span class="ident">std::io::prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">std::io</span>;

<span class="kw">struct</span> <span class="ident">Info</span> {
    <span class="ident">name</span>: <span class="ident">String</span>,
    <span class="ident">age</span>: <span class="ident">i32</span>,
    <span class="ident">rating</span>: <span class="ident">i32</span>,
}

<span class="kw">fn</span> <span class="ident">write_info</span>(<span class="ident">info</span>: <span class="kw-2">&amp;</span><span class="ident">Info</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">io::Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="comment">// 尽早返回错误</span>
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">file</span> <span class="op">=</span> <span class="kw">match</span> <span class="ident">File::create</span>(<span class="string">&quot;my_best_friends.txt&quot;</span>) {
           <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="kw">return</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>),
           <span class="prelude-val">Ok</span>(<span class="ident">f</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="ident">f</span>,
    };
    <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span> <span class="ident">file</span>.<span class="ident">write_all</span>(<span class="macro">format!</span>(<span class="string">&quot;name: {}\n&quot;</span>, <span class="ident">info</span>.<span class="ident">name</span>).<span class="ident">as_bytes</span>()) {
        <span class="kw">return</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>)
    }
    <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span> <span class="ident">file</span>.<span class="ident">write_all</span>(<span class="macro">format!</span>(<span class="string">&quot;age: {}\n&quot;</span>, <span class="ident">info</span>.<span class="ident">age</span>).<span class="ident">as_bytes</span>()) {
        <span class="kw">return</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>)
    }
    <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span> <span class="ident">file</span>.<span class="ident">write_all</span>(<span class="macro">format!</span>(<span class="string">&quot;rating: {}\n&quot;</span>, <span class="ident">info</span>.<span class="ident">rating</span>).<span class="ident">as_bytes</span>()) {
        <span class="kw">return</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>)
    }
    <span class="prelude-val">Ok</span>(())
}</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0A%23!%5Ballow(dead_code)%5D%0Afn%20main()%20%7B%0Ause%20std%3A%3Afs%3A%3AFile%3B%0Ause%20std%3A%3Aio%3A%3Aprelude%3A%3A*%3B%0Ause%20std%3A%3Aio%3B%0A%0Astruct%20Info%20%7B%0A%20%20%20%20name%3A%20String%2C%0A%20%20%20%20age%3A%20i32%2C%0A%20%20%20%20rating%3A%20i32%2C%0A%7D%0A%0Afn%20write_info(info%3A%20%26Info)%20-%3E%20io%3A%3AResult%3C()%3E%20%7B%0A%20%20%20%20%2F%2F%20%E5%B0%BD%E6%97%A9%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%0A%20%20%20%20let%20mut%20file%20%3D%20match%20File%3A%3Acreate(%22my_best_friends.txt%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20Err(e)%20%3D%3E%20return%20Err(e)%2C%0A%20%20%20%20%20%20%20%20%20%20%20Ok(f)%20%3D%3E%20f%2C%0A%20%20%20%20%7D%3B%0A%20%20%20%20if%20let%20Err(e)%20%3D%20file.write_all(format!(%22name%3A%20%7B%7D%5Cn%22%2C%20info.name).as_bytes())%20%7B%0A%20%20%20%20%20%20%20%20return%20Err(e)%0A%20%20%20%20%7D%0A%20%20%20%20if%20let%20Err(e)%20%3D%20file.write_all(format!(%22age%3A%20%7B%7D%5Cn%22%2C%20info.age).as_bytes())%20%7B%0A%20%20%20%20%20%20%20%20return%20Err(e)%0A%20%20%20%20%7D%0A%20%20%20%20if%20let%20Err(e)%20%3D%20file.write_all(format!(%22rating%3A%20%7B%7D%5Cn%22%2C%20info.rating).as_bytes())%20%7B%0A%20%20%20%20%20%20%20%20return%20Err(e)%0A%20%20%20%20%7D%0A%20%20%20%20Ok(())%0A%7D%0A%7D&amp;edition=2018">Run</a></div>
<p>有了这个:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std::fs::File</span>;
<span class="kw">use</span> <span class="ident">std::io::prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">std::io</span>;

<span class="kw">struct</span> <span class="ident">Info</span> {
    <span class="ident">name</span>: <span class="ident">String</span>,
    <span class="ident">age</span>: <span class="ident">i32</span>,
    <span class="ident">rating</span>: <span class="ident">i32</span>,
}

<span class="kw">fn</span> <span class="ident">write_info</span>(<span class="ident">info</span>: <span class="kw-2">&amp;</span><span class="ident">Info</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">io::Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">file</span> <span class="op">=</span> <span class="ident">File::create</span>(<span class="string">&quot;my_best_friends.txt&quot;</span>)<span class="question-mark">?</span>;
    <span class="comment">// 尽早返回错误</span>
    <span class="ident">file</span>.<span class="ident">write_all</span>(<span class="macro">format!</span>(<span class="string">&quot;name: {}\n&quot;</span>, <span class="ident">info</span>.<span class="ident">name</span>).<span class="ident">as_bytes</span>())<span class="question-mark">?</span>;
    <span class="ident">file</span>.<span class="ident">write_all</span>(<span class="macro">format!</span>(<span class="string">&quot;age: {}\n&quot;</span>, <span class="ident">info</span>.<span class="ident">age</span>).<span class="ident">as_bytes</span>())<span class="question-mark">?</span>;
    <span class="ident">file</span>.<span class="ident">write_all</span>(<span class="macro">format!</span>(<span class="string">&quot;rating: {}\n&quot;</span>, <span class="ident">info</span>.<span class="ident">rating</span>).<span class="ident">as_bytes</span>())<span class="question-mark">?</span>;
    <span class="prelude-val">Ok</span>(())
}</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0A%23!%5Ballow(dead_code)%5D%0Afn%20main()%20%7B%0Ause%20std%3A%3Afs%3A%3AFile%3B%0Ause%20std%3A%3Aio%3A%3Aprelude%3A%3A*%3B%0Ause%20std%3A%3Aio%3B%0A%0Astruct%20Info%20%7B%0A%20%20%20%20name%3A%20String%2C%0A%20%20%20%20age%3A%20i32%2C%0A%20%20%20%20rating%3A%20i32%2C%0A%7D%0A%0Afn%20write_info(info%3A%20%26Info)%20-%3E%20io%3A%3AResult%3C()%3E%20%7B%0A%20%20%20%20let%20mut%20file%20%3D%20File%3A%3Acreate(%22my_best_friends.txt%22)%3F%3B%0A%20%20%20%20%2F%2F%20%E5%B0%BD%E6%97%A9%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%0A%20%20%20%20file.write_all(format!(%22name%3A%20%7B%7D%5Cn%22%2C%20info.name).as_bytes())%3F%3B%0A%20%20%20%20file.write_all(format!(%22age%3A%20%7B%7D%5Cn%22%2C%20info.age).as_bytes())%3F%3B%0A%20%20%20%20file.write_all(format!(%22rating%3A%20%7B%7D%5Cn%22%2C%20info.rating).as_bytes())%3F%3B%0A%20%20%20%20Ok(())%0A%7D%0A%7D&amp;edition=2018">Run</a></div>
<p><em>好多了!</em></p>
<p>用 <a href="../ops/trait.Try.html"><code>?</code></a> 结束表达式将得到未包装的成功 (<a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a>) 值，除非结果为 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a>，在这种情况下，<a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 会从封闭的函数中提前返回。</p>
<p><a href="../ops/trait.Try.html"><code>?</code></a> 只能在返回 <a href="enum.Result.html" title="Result"><code>Result</code></a> 的函数中使用，因为它提供了 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 的较早返回。</p>
<h1 id="方法概述" class="section-header"><a href="#方法概述">方法概述</a></h1>
<p>除了使用模式匹配，<a href="enum.Result.html" title="Result"><code>Result</code></a> 还提供了多种不同的方法。</p>
<h2 id="查询变量" class="section-header"><a href="#查询变量">查询变量</a></h2>
<p>如果 <a href="enum.Result.html" title="Result"><code>Result</code></a> 分别为 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 或 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a>，则 <a href="enum.Result.html#method.is_ok"><code>is_ok</code></a> 和 <a href="enum.Result.html#method.is_err"><code>is_err</code></a> 方法返回 <a href="https://doc.rust-lang.org/1.54.0/std/primitive.bool.html" title="true"><code>true</code></a>。</p>
<h2 id="用于处理引用的适配器" class="section-header"><a href="#用于处理引用的适配器">用于处理引用的适配器</a></h2>
<ul>
<li><a href="enum.Result.html#method.as_ref"><code>as_ref</code></a> 从 <code>&amp;Result&lt;T, E&gt;</code> 转换为 <code>Result&lt;&amp;T, &amp;E&gt;</code></li>
<li><a href="enum.Result.html#method.as_mut"><code>as_mut</code></a> 从 <code>&amp;mut Result&lt;T, E&gt;</code> 转换为 <code>Result&lt;&amp;mut T, &amp;mut E&gt;</code></li>
<li><a href="enum.Result.html#method.as_deref"><code>as_deref</code></a> 从 <code>&amp;Result&lt;T, E&gt;</code> 转换为 <code>Result&lt;&amp;T::Target, &amp;E&gt;</code></li>
<li><a href="enum.Result.html#method.as_deref_mut"><code>as_deref_mut</code></a> 从 <code>&amp;mut Result&lt;T, E&gt;</code> 转换为
<code>Result&lt;&amp;mut T::Target, &amp;mut E&gt;</code></li>
</ul>
<h2 id="提取包含的值" class="section-header"><a href="#提取包含的值">提取包含的值</a></h2>
<p>当它是 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 成员时，这些方法提取 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 中包含的值。如果 <a href="enum.Result.html" title="Result"><code>Result</code></a> 是 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a>:</p>
<ul>
<li><a href="enum.Result.html#method.expect"><code>expect</code></a> 一个提供自定义消息的 panics</li>
<li><a href="enum.Result.html#method.unwrap"><code>unwrap</code></a> 带有通用消息的 panics</li>
<li><a href="enum.Result.html#method.unwrap_or"><code>unwrap_or</code></a> 返回提供的默认值</li>
<li><a href="enum.Result.html#method.unwrap_or_default"><code>unwrap_or_default</code></a> 返回类型 <code>T</code> 的默认值 (必须实现 <a href="../default/trait.Default.html" title="Default"><code>Default</code></a> trait)</li>
<li><a href="enum.Result.html#method.unwrap_or_else"><code>unwrap_or_else</code></a> 返回对提供的函数求值的结果</li>
</ul>
<p>panicking 方法 <a href="enum.Result.html#method.expect"><code>expect</code></a> 和 <a href="enum.Result.html#method.unwrap"><code>unwrap</code></a> 需要 <code>E</code> 来实现 <a href="../fmt/trait.Debug.html"><code>Debug</code></a> trait。</p>
<p>当它是 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 成员时，这些方法提取 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 中包含的值。他们需要 <code>T</code> 来实现 <a href="../fmt/trait.Debug.html"><code>Debug</code></a> trait。如果 <a href="enum.Result.html" title="Result"><code>Result</code></a> 是 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a>:</p>
<ul>
<li><a href="enum.Result.html#method.expect_err"><code>expect_err</code></a> 一个提供自定义消息的 panics</li>
<li><a href="enum.Result.html#method.unwrap_err"><code>unwrap_err</code></a> 带有通用消息的 panics</li>
</ul>
<h2 id="转换包含的值" class="section-header"><a href="#转换包含的值">转换包含的值</a></h2>
<p>这些方法将 <a href="enum.Result.html" title="Result"><code>Result</code></a> 转换为 <a href="../option/enum.Option.html" title="Option"><code>Option</code></a>:</p>
<ul>
<li><a href="enum.Result.html#method.err" title="Result::err"><code>err</code></a> 将 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 转换为 <a href="../option/enum.Option.html" title="Option&lt;E&gt;"><code>Option&lt;E&gt;</code></a>，将 <a href="enum.Result.html#variant.Err"><code>Err(e)</code></a> 映射到 <a href="../option/enum.Option.html#variant.Some"><code>Some(e)</code></a>，将 <a href="enum.Result.html#variant.Ok"><code>Ok(v)</code></a> 映射到 <a href="../option/enum.Option.html#variant.None" title="None"><code>None</code></a></li>
<li><a href="enum.Result.html#method.ok" title="Result::ok"><code>ok</code></a> 将 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 转换为 <a href="../option/enum.Option.html" title="Option&lt;T&gt;"><code>Option&lt;T&gt;</code></a>，将 <a href="enum.Result.html#variant.Ok"><code>Ok(v)</code></a> 映射到 <a href="../option/enum.Option.html#variant.Some"><code>Some(v)</code></a>，将 <a href="enum.Result.html#variant.Err"><code>Err(e)</code></a> 映射到 <a href="../option/enum.Option.html#variant.None" title="None"><code>None</code></a></li>
<li><a href="enum.Result.html#method.transpose"><code>transpose</code></a> 将 <a href="../option/enum.Option.html" title="Option"><code>Option</code></a> 的 <a href="enum.Result.html" title="Result"><code>Result</code></a> 转换为 <a href="enum.Result.html" title="Result"><code>Result</code></a> 的 <a href="../option/enum.Option.html" title="Option"><code>Option</code></a></li>
</ul>
<p>此方法转换 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 成员的包含值:</p>
<ul>
<li><a href="enum.Result.html#method.map"><code>map</code></a> 通过将提供的函数应用于 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 的包含值并保持 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 值不变，将 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 转换为 <a href="enum.Result.html" title="Result&lt;U, E&gt;"><code>Result&lt;U, E&gt;</code></a></li>
</ul>
<p>此方法转换 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 成员的包含值:</p>
<ul>
<li><a href="enum.Result.html#method.map_err"><code>map_err</code></a> 通过将提供的函数应用于 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 的包含值并保持 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 值不变，将 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 转换为 <a href="enum.Result.html" title="Result&lt;T, F&gt;"><code>Result&lt;T, F&gt;</code></a></li>
</ul>
<p>这些方法将 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 转换为可能不同类型 <code>U</code> 的值:</p>
<ul>
<li><a href="enum.Result.html#method.map_or"><code>map_or</code></a> 将提供的函数应用于 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 的包含值，如果 <a href="enum.Result.html" title="Result"><code>Result</code></a> 是，则返回提供的默认值
<a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a></li>
<li><a href="enum.Result.html#method.map_or_else"><code>map_or_else</code></a> 将提供的函数应用于 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 的包含值，或将提供的回退函数应用于 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 的包含值</li>
</ul>
<h2 id="布尔运算符" class="section-header"><a href="#布尔运算符">布尔运算符</a></h2>
<p>这些方法将 <a href="enum.Result.html" title="Result"><code>Result</code></a> 视为布尔值，其中 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 的作用类似于 <a href="https://doc.rust-lang.org/1.54.0/std/primitive.bool.html" title="true"><code>true</code></a>，而 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 的作用类似于 <a href="https://doc.rust-lang.org/1.54.0/std/primitive.bool.html" title="false"><code>false</code></a>。这些方法有两类: 一类以 <a href="enum.Result.html" title="Result"><code>Result</code></a> 作为输入，一类以函数作为输入 (延迟评估)。</p>
<p><a href="enum.Result.html#method.and"><code>and</code></a> 和 <a href="enum.Result.html#method.or"><code>or</code></a> 方法将另一个 <a href="enum.Result.html" title="Result"><code>Result</code></a> 作为输入，并生成一个 <a href="enum.Result.html" title="Result"><code>Result</code></a> 作为输出。<a href="enum.Result.html#method.and"><code>and</code></a> 方法可以生成具有与 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 不同的内部类型 <code>U</code> 的 <a href="enum.Result.html" title="Result&lt;U, E&gt;"><code>Result&lt;U, E&gt;</code></a> 值。
<a href="enum.Result.html#method.or"><code>or</code></a> 方法可以生成具有与 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 不同的错误类型 <code>F</code> 的 <a href="enum.Result.html" title="Result&lt;T, F&gt;"><code>Result&lt;T, F&gt;</code></a> 值。</p>
<table><thead><tr><th>method</th><th>self</th><th>input</th><th>output</th></tr></thead><tbody>
<tr><td><a href="enum.Result.html#method.and"><code>and</code></a></td><td><code>Err(e)</code></td><td>(ignored)</td><td><code>Err(e)</code></td></tr>
<tr><td><a href="enum.Result.html#method.and"><code>and</code></a></td><td><code>Ok(x)</code></td><td><code>Err(d)</code></td><td><code>Err(d)</code></td></tr>
<tr><td><a href="enum.Result.html#method.and"><code>and</code></a></td><td><code>Ok(x)</code></td><td><code>Ok(y)</code></td><td><code>Ok(y)</code></td></tr>
<tr><td><a href="enum.Result.html#method.or"><code>or</code></a></td><td><code>Err(e)</code></td><td><code>Err(d)</code></td><td><code>Err(d)</code></td></tr>
<tr><td><a href="enum.Result.html#method.or"><code>or</code></a></td><td><code>Err(e)</code></td><td><code>Ok(y)</code></td><td><code>Ok(y)</code></td></tr>
<tr><td><a href="enum.Result.html#method.or"><code>or</code></a></td><td><code>Ok(x)</code></td><td>(ignored)</td><td><code>Ok(x)</code></td></tr>
</tbody></table>
<p><a href="enum.Result.html#method.and_then"><code>and_then</code></a> 和 <a href="enum.Result.html#method.or_else"><code>or_else</code></a> 方法将函数作为输入，并且仅在需要产生新值时才评估函数。<a href="enum.Result.html#method.and_then"><code>and_then</code></a> 方法可以生成具有与 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 不同的内部类型 <code>U</code> 的 <a href="enum.Result.html" title="Result&lt;U, E&gt;"><code>Result&lt;U, E&gt;</code></a> 值。
<a href="enum.Result.html#method.or_else"><code>or_else</code></a> 方法可以生成具有与 <a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 不同的错误类型 <code>F</code> 的 <a href="enum.Result.html" title="Result&lt;T, F&gt;"><code>Result&lt;T, F&gt;</code></a> 值。</p>
<table><thead><tr><th>method</th><th>self</th><th>function input</th><th>function result</th><th>output</th></tr></thead><tbody>
<tr><td><a href="enum.Result.html#method.and_then"><code>and_then</code></a></td><td><code>Err(e)</code></td><td>(not provided)</td><td>(not evaluated)</td><td><code>Err(e)</code></td></tr>
<tr><td><a href="enum.Result.html#method.and_then"><code>and_then</code></a></td><td><code>Ok(x)</code></td><td><code>x</code></td><td><code>Err(d)</code></td><td><code>Err(d)</code></td></tr>
<tr><td><a href="enum.Result.html#method.and_then"><code>and_then</code></a></td><td><code>Ok(x)</code></td><td><code>x</code></td><td><code>Ok(y)</code></td><td><code>Ok(y)</code></td></tr>
<tr><td><a href="enum.Result.html#method.or_else"><code>or_else</code></a></td><td><code>Err(e)</code></td><td><code>e</code></td><td><code>Err(d)</code></td><td><code>Err(d)</code></td></tr>
<tr><td><a href="enum.Result.html#method.or_else"><code>or_else</code></a></td><td><code>Err(e)</code></td><td><code>e</code></td><td><code>Ok(y)</code></td><td><code>Ok(y)</code></td></tr>
<tr><td><a href="enum.Result.html#method.or_else"><code>or_else</code></a></td><td><code>Ok(x)</code></td><td>(not provided)</td><td>(not evaluated)</td><td><code>Ok(x)</code></td></tr>
</tbody></table>
<h2 id="迭代-result" class="section-header"><a href="#迭代-result">迭代 <code>Result</code></a></h2>
<p>可以对 <a href="enum.Result.html" title="Result"><code>Result</code></a> 进行迭代。如果您需要一个条件为空的迭代器，这会很有帮助。迭代器将产生单个值 (当 <a href="enum.Result.html" title="Result"><code>Result</code></a> 为 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 时)，或不产生任何值 (当 <a href="enum.Result.html" title="Result"><code>Result</code></a> 为 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a> 时)。
例如，如果 <a href="enum.Result.html" title="Result"><code>Result</code></a> 是 <a href="enum.Result.html#variant.Ok"><code>Ok(v)</code></a>，则 <a href="enum.Result.html#method.into_iter"><code>into_iter</code></a> 的作用类似于 <a href="../iter/fn.once.html"><code>once(v)</code></a>; 如果 <a href="enum.Result.html" title="Result"><code>Result</code></a> 是 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a>，则它的作用类似于 <a href="../iter/fn.empty.html"><code>empty()</code></a>。</p>
<p><a href="enum.Result.html" title="Result&lt;T, E&gt;"><code>Result&lt;T, E&gt;</code></a> 上的迭代器分为三种类型:</p>
<ul>
<li><a href="enum.Result.html#method.into_iter"><code>into_iter</code></a> 消耗 <a href="enum.Result.html" title="Result"><code>Result</code></a> 并生成包含的值</li>
<li><a href="enum.Result.html#method.iter"><code>iter</code></a> 对包含的值产生类型为 <code>&amp;T</code> 的不支持引用</li>
<li><a href="enum.Result.html#method.iter_mut"><code>iter_mut</code></a> 产生一个 <code>&amp;mut T</code> 类型的引用引用到包含的值</li>
</ul>
<p>有关这如何有用的示例，请参见 <a href="../option/index.html#iterating-over-option">迭代 <code>Option</code></a>。</p>
<p>您可能希望使用迭代器链来执行可能失败的操作的多个实例，但希望在继续处理成功结果的同时忽略失败。
在本例中，我们利用 <a href="enum.Result.html" title="Result"><code>Result</code></a> 的可迭代特性，使用 <a href="../iter/trait.Iterator.html#method.flatten" title="Iterator::flatten"><code>flatten</code></a> 仅选择 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 值。</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">results</span> <span class="op">=</span> <span class="macro">vec!</span>[];
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">errs</span> <span class="op">=</span> <span class="macro">vec!</span>[];
<span class="kw">let</span> <span class="ident">nums</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw">_</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[<span class="string">&quot;17&quot;</span>, <span class="string">&quot;not a number&quot;</span>, <span class="string">&quot;99&quot;</span>, <span class="string">&quot;-27&quot;</span>, <span class="string">&quot;768&quot;</span>]
   .<span class="ident">into_iter</span>()
   .<span class="ident">map</span>(<span class="ident">u8::from_str</span>)
   <span class="comment">// 保存原始 `Result` 值的克隆以进行检查</span>
   .<span class="ident">inspect</span>(<span class="op">|</span><span class="ident">x</span><span class="op">|</span> <span class="ident">results</span>.<span class="ident">push</span>(<span class="ident">x</span>.<span class="ident">clone</span>()))
   <span class="comment">// 挑战: 解释这如何仅捕获 `Err` 值</span>
   .<span class="ident">inspect</span>(<span class="op">|</span><span class="ident">x</span><span class="op">|</span> <span class="ident">errs</span>.<span class="ident">extend</span>(<span class="ident">x</span>.<span class="ident">clone</span>().<span class="ident">err</span>()))
   .<span class="ident">flatten</span>()
   .<span class="ident">collect</span>();
<span class="macro">assert_eq!</span>(<span class="ident">errs</span>.<span class="ident">len</span>(), <span class="number">3</span>);
<span class="macro">assert_eq!</span>(<span class="ident">nums</span>, [<span class="number">17</span>, <span class="number">99</span>]);
<span class="macro">println!</span>(<span class="string">&quot;results {:?}&quot;</span>, <span class="ident">results</span>);
<span class="macro">println!</span>(<span class="string">&quot;errs {:?}&quot;</span>, <span class="ident">errs</span>);
<span class="macro">println!</span>(<span class="string">&quot;nums {:?}&quot;</span>, <span class="ident">nums</span>);</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Ause%20std%3A%3Astr%3A%3AFromStr%3B%0Alet%20mut%20results%20%3D%20vec!%5B%5D%3B%0Alet%20mut%20errs%20%3D%20vec!%5B%5D%3B%0Alet%20nums%3A%20Vec%3C_%3E%20%3D%20vec!%5B%2217%22%2C%20%22not%20a%20number%22%2C%20%2299%22%2C%20%22-27%22%2C%20%22768%22%5D%0A%20%20%20.into_iter()%0A%20%20%20.map(u8%3A%3Afrom_str)%0A%20%20%20%2F%2F%20%E4%BF%9D%E5%AD%98%E5%8E%9F%E5%A7%8B%20%60Result%60%20%E5%80%BC%E7%9A%84%E5%85%8B%E9%9A%86%E4%BB%A5%E8%BF%9B%E8%A1%8C%E6%A3%80%E6%9F%A5%0A%20%20%20.inspect(%7Cx%7C%20results.push(x.clone()))%0A%20%20%20%2F%2F%20%E6%8C%91%E6%88%98%3A%20%E8%A7%A3%E9%87%8A%E8%BF%99%E5%A6%82%E4%BD%95%E4%BB%85%E6%8D%95%E8%8E%B7%20%60Err%60%20%E5%80%BC%0A%20%20%20.inspect(%7Cx%7C%20errs.extend(x.clone().err()))%0A%20%20%20.flatten()%0A%20%20%20.collect()%3B%0Aassert_eq!(errs.len()%2C%203)%3B%0Aassert_eq!(nums%2C%20%5B17%2C%2099%5D)%3B%0Aprintln!(%22results%20%7B%3A%3F%7D%22%2C%20results)%3B%0Aprintln!(%22errs%20%7B%3A%3F%7D%22%2C%20errs)%3B%0Aprintln!(%22nums%20%7B%3A%3F%7D%22%2C%20nums)%3B%0A%7D&amp;edition=2018">Run</a></div>
<h2 id="收集到-result" class="section-header"><a href="#收集到-result">收集到 <code>Result</code></a></h2>
<p><a href="enum.Result.html" title="Result"><code>Result</code></a> 实现 <a href="enum.Result.html#impl-FromIterator%3CResult%3CA%2C%20E%3E%3E"><code>FromIterator</code></a> trait，它允许将 <a href="enum.Result.html" title="Result"><code>Result</code></a> 值上的迭代器收集到原始 <a href="enum.Result.html" title="Result"><code>Result</code></a> 值的每个包含值的集合的 <a href="enum.Result.html" title="Result"><code>Result</code></a> 中，或者如果任何元素是 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a>，则为 <a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a>。</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">let</span> <span class="ident">v</span> <span class="op">=</span> <span class="macro">vec!</span>[<span class="prelude-val">Ok</span>(<span class="number">2</span>), <span class="prelude-val">Ok</span>(<span class="number">4</span>), <span class="prelude-val">Err</span>(<span class="string">&quot;err!&quot;</span>), <span class="prelude-val">Ok</span>(<span class="number">8</span>)];
<span class="kw">let</span> <span class="ident">res</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="kw">_</span><span class="op">&gt;</span>, <span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">v</span>.<span class="ident">into_iter</span>().<span class="ident">collect</span>();
<span class="macro">assert_eq!</span>(<span class="ident">res</span>, <span class="prelude-val">Err</span>(<span class="string">&quot;err!&quot;</span>));
<span class="kw">let</span> <span class="ident">v</span> <span class="op">=</span> <span class="macro">vec!</span>[<span class="prelude-val">Ok</span>(<span class="number">2</span>), <span class="prelude-val">Ok</span>(<span class="number">4</span>), <span class="prelude-val">Ok</span>(<span class="number">8</span>)];
<span class="kw">let</span> <span class="ident">res</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="kw">_</span><span class="op">&gt;</span>, <span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">v</span>.<span class="ident">into_iter</span>().<span class="ident">collect</span>();
<span class="macro">assert_eq!</span>(<span class="ident">res</span>, <span class="prelude-val">Ok</span>(<span class="macro">vec!</span>[<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>]));</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Alet%20v%20%3D%20vec!%5BOk(2)%2C%20Ok(4)%2C%20Err(%22err!%22)%2C%20Ok(8)%5D%3B%0Alet%20res%3A%20Result%3CVec%3C_%3E%2C%20%26str%3E%20%3D%20v.into_iter().collect()%3B%0Aassert_eq!(res%2C%20Err(%22err!%22))%3B%0Alet%20v%20%3D%20vec!%5BOk(2)%2C%20Ok(4)%2C%20Ok(8)%5D%3B%0Alet%20res%3A%20Result%3CVec%3C_%3E%2C%20%26str%3E%20%3D%20v.into_iter().collect()%3B%0Aassert_eq!(res%2C%20Ok(vec!%5B2%2C%204%2C%208%5D))%3B%0A%7D&amp;edition=2018">Run</a></div>
<p><a href="enum.Result.html" title="Result"><code>Result</code></a> 还实现了 <a href="enum.Result.html#impl-Product%3CResult%3CU%2C%20E%3E%3E"><code>Product</code></a> 和 <a href="enum.Result.html#impl-Sum%3CResult%3CU%2C%20E%3E%3E"><code>Sum</code></a> traits，允许对 <a href="enum.Result.html" title="Result"><code>Result</code></a> 值的迭代器提供 <a href="../iter/trait.Iterator.html#method.product" title="Iterator::product"><code>product</code></a> 和 <a href="../iter/trait.Iterator.html#method.sum" title="Iterator::sum"><code>sum</code></a> 方法。</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">let</span> <span class="ident">v</span> <span class="op">=</span> <span class="macro">vec!</span>[<span class="prelude-val">Err</span>(<span class="string">&quot;error!&quot;</span>), <span class="prelude-val">Ok</span>(<span class="number">1</span>), <span class="prelude-val">Ok</span>(<span class="number">2</span>), <span class="prelude-val">Ok</span>(<span class="number">3</span>), <span class="prelude-val">Err</span>(<span class="string">&quot;foo&quot;</span>)];
<span class="kw">let</span> <span class="ident">res</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">v</span>.<span class="ident">into_iter</span>().<span class="ident">sum</span>();
<span class="macro">assert_eq!</span>(<span class="ident">res</span>, <span class="prelude-val">Err</span>(<span class="string">&quot;error!&quot;</span>));
<span class="kw">let</span> <span class="ident">v</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[<span class="prelude-val">Ok</span>(<span class="number">1</span>), <span class="prelude-val">Ok</span>(<span class="number">2</span>), <span class="prelude-val">Ok</span>(<span class="number">21</span>)];
<span class="kw">let</span> <span class="ident">res</span>: <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">i32</span>, <span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">v</span>.<span class="ident">into_iter</span>().<span class="ident">product</span>();
<span class="macro">assert_eq!</span>(<span class="ident">res</span>, <span class="prelude-val">Ok</span>(<span class="number">42</span>));</pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Alet%20v%20%3D%20vec!%5BErr(%22error!%22)%2C%20Ok(1)%2C%20Ok(2)%2C%20Ok(3)%2C%20Err(%22foo%22)%5D%3B%0Alet%20res%3A%20Result%3Ci32%2C%20%26str%3E%20%3D%20v.into_iter().sum()%3B%0Aassert_eq!(res%2C%20Err(%22error!%22))%3B%0Alet%20v%3A%20Vec%3CResult%3Ci32%2C%20%26str%3E%3E%20%3D%20vec!%5BOk(1)%2C%20Ok(2)%2C%20Ok(21)%5D%3B%0Alet%20res%3A%20Result%3Ci32%2C%20%26str%3E%20%3D%20v.into_iter().product()%3B%0Aassert_eq!(res%2C%20Ok(42))%3B%0A%7D&amp;edition=2018">Run</a></div>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.IntoIter.html" title="core::result::IntoIter struct">IntoIter</a></td><td class="docblock-short"><p><a href="enum.Result.html" title="Result"><code>Result</code></a> 的 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 成员中的值的迭代器。</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.Iter.html" title="core::result::Iter struct">Iter</a></td><td class="docblock-short"><p><a href="enum.Result.html" title="Result"><code>Result</code></a> 的 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 成员的引用上的迭代器。</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.IterMut.html" title="core::result::IterMut struct">IterMut</a></td><td class="docblock-short"><p><a href="enum.Result.html" title="Result"><code>Result</code></a> 的 <a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a> 成员的可变引用上的迭代器。</p>
</td></tr></table><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<table><tr class="module-item"><td><a class="enum" href="enum.Result.html" title="core::result::Result enum">Result</a></td><td class="docblock-short"><p><code>Result</code> 是代表成功 (<a href="enum.Result.html#variant.Ok" title="Ok"><code>Ok</code></a>) 或失败 (<a href="enum.Result.html#variant.Err" title="Err"><code>Err</code></a>) 的类型。</p>
</td></tr></table></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="core" data-search-index-js="../../search-index1.55.0.js" data-search-js="../../search1.55.0.js"></div><script src="../../main1.55.0.js"></script></body></html>